<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>註冊/登入</title>
</head>
<link rel="stylesheet" href="/urlDemo.css">
<script src="/jquery.min.js"></script>
<script>

    function show(res) {
        $('#result').text(JSON.stringify(res, null, 2));
    }

    const BASE = 'http://localhost:8080/api/';
    $(document).ready(function () {
        // 註冊
        $('#btnRegister').click(function () {
            const data = {
                username: $('#regUser').val(),
                password: $('#regPass').val()
            };
            $.ajax({
                url: BASE + 'auth/register',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(data),
                success: function (res) {
                    show(res)
                    $('#loginUser').val($('#regUser').val())
                    $('#loginPass').val($('#regPass').val())
                },
                error: function (xhr, status, error) {
                    show(xhr)
                }
            });
        });
        // 登入
        $('#btnLogin').click(function () {
            const data = {
                username: $('#loginUser').val(),
                password: $('#loginPass').val()
            };
            $.ajax({
                url: BASE + 'auth/login',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(data),
                success: function (res) {
                    show(res)
                    if (res.token) {
                        $('#token').val(res.token);
                        $('#token').css("width", ($('#token').val().length + 1) + "ch");
                    }
                },
                error: function (xhr, status, error) {
                    show(xhr)
                }
            });
        });
        // 更改密碼
        $('#btnUpdatePassword').click(function () {
            const data = {
                username: $('#loginUser').val(),
                password: $('#loginPass').val()
            };
            $.ajax({
                url: BASE + 'auth/updatePassword',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(data),
                success: function (res) {
                    show(res)
                    if (res.token) {
                        $('#token').val(res.token);
                        $('#token').css("width", ($('#token').val().length + 1) + "ch");
                    }
                },
                error: function (xhr, status, error) {
                    show(xhr)
                }
            });
        });
        // 驗證 Token
        $('#btnValidate').click(function () {
            const token = $('#token').val();
            $.ajax({
                url: BASE + 'auth/validate',
                type: 'GET',
                data: { token: token },
                success: function (res) {
                    show(res)
                },
                error: function (xhr, status, error) {
                    show(xhr)
                }
            });
        });
        // 查詢 Token
        $('#btnQuery').click(function () {
            const data = {
                username: $('#queryUser').val(),
                password: $('#queryPass').val()
            };
            $.ajax({
                url: BASE + 'auth/query',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(data),
                success: function (res) {
                    show(res)
                    if (res.token) {
                        $('#tokenLogout').val(res.token);
                        if (res.token.length > 0) {
                            $('#tokenLogout').css("width", ($('#tokenLogout').val().length + 1) + "ch");
                        }
                    }
                },
                error: function (xhr, status, error) {
                    show(xhr)
                }
            });
        });
        // 登出
        $('#btnLogout').click(function () {
            const token = $('#tokenLogout').val();
            $.ajax({
                url: BASE + 'auth/logout',
                type: 'GET',
                data: { token: token },
                success: function (res) {
                    show(res)
                },
                error: function (xhr, status, error) {
                    show(xhr)
                }
            });
        });
    });


</script>

<body>
    <section>
        <h2>註冊</h2>
        <input id="regUser" placeholder="帳號">
        <input id="regPass" placeholder="密碼">
        <button id="btnRegister">註冊</button>
        <h2>登入</h2>
        <input id="loginUser" placeholder="帳號">
        <input id="loginPass" placeholder="密碼">
        <button id="btnLogin">登入</button>
        <button id="btnUpdatePassword">更改密碼</button>
        <h2>驗證 Token</h2>
        <input id="token" placeholder="Token">
        <button id="btnValidate">驗證</button>
    </section>
    <section>
        <h2>查詢 Token</h2>
        <input id="queryUser" placeholder="帳號">
        <input id="queryPass" placeholder="密碼">
        <button id="btnQuery">查詢</button>
        <h2>登出 Token</h2>
        <input id="tokenLogout" placeholder="Token">
        <button id="btnLogout">登出</button>
    </section>
    <section>
        <h3>API Result</h3>
        <pre id="result"></pre>
    </section>
</body>

</html>