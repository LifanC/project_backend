<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>註冊/登入</title>
</head>
<script src="/jquery.min.js"></script>
<script>
    var http = 'http://localhost:8080/api/';
    $(document).ready(function () {
        // 註冊
        $('#btnRegister').click(function () {
            const data = {
                username: $('#regUser').val(),
                password: $('#regPass').val()
            };
            $.ajax({
                url: http + 'auth/register',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(data),
                success: function (res) {
                    if (res.register) {
                        alert("註冊成功: " + res.msg);
                        $('#loginUser').val($('#regUser').val())
                        $('#loginPass').val($('#regPass').val())
                    } else {
                        alert("註冊失敗: " + res.msg);
                    }
                },
                error: function (xhr, status, error) {
                    alert("註冊失敗error: " + xhr.responseText);
                }
            });
        });
        // 登入
        $('#btnLogin').click(function () {
            const data = {
                username: $('#loginUser').val(),
                password: $('#loginPass').val()
            };
            $.ajax({
                url: http + 'auth/login',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(data),
                success: function (res) {
                    if (res.login) {
                        alert("登入成功! Token: " + res.msg);
                        $('#token').val(res.msg);
                        $('#token').css("width", ($('#token').val().length + 1) + "ch");
                    } else {
                        alert("登入失敗: " + res.msg);
                    }
                },
                error: function (xhr) {
                    alert("登入失敗error: " + xhr.responseText);
                }
            });
        });
        // 驗證 Token
        $('#btnValidate').click(function () {
            const token = $('#token').val();
            $.ajax({
                url: http + 'auth/validate',
                type: 'GET',
                data: { token: token },
                success: function (res) {
                    if (res.validate) {
                        alert("驗證結果: " + res.msg);
                    } else {
                        alert("驗證失敗: " + res.msg);
                    }
                },
                error: function (xhr) {
                    alert("驗證失敗error: " + xhr.responseText);
                }
            });
        });
        // 查詢 Token
        $('#btnQuery').click(function () {
            const data = {
                username: $('#queryUser').val(),
                password: $('#queryPass').val()
            };
            $.ajax({
                url: http + 'auth/query',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(data),
                success: function (res) {
                    if (res.query) {
                        alert("查詢成功! Token: " + res.msg);
                        $('#token').val(res.msg);
                        if (res.msg.length > 0) {
                            $('#token').css("width", ($('#token').val().length + 1) + "ch");
                        }
                    } else {
                        alert("查詢失敗: " + res.msg);
                    }
                },
                error: function (xhr) {
                    alert("查詢失敗error: " + xhr.responseText);
                }
            });
        });
        // 登出
        $('#btnLogout').click(function () {
            const token = $('#token').val();
            $.ajax({
                url: http + 'auth/logout',
                type: 'GET',
                data: { token: token },
                success: function (res) {
                    if (res.logout) {
                        alert("登出結果: " + res.msg);
                    } else {
                        alert("登出失敗: " + res.msg);
                    }
                },
                error: function (xhr) {
                    alert("登出失敗error: " + xhr.responseText);
                }
            });
        });
    });


</script>

<body>
    <h2>註冊</h2>
    <input id="regUser" placeholder="帳號">
    <input id="regPass" placeholder="密碼">
    <button id="btnRegister">註冊</button>

    <h2>登入</h2>
    <input id="loginUser" placeholder="帳號">
    <input id="loginPass" placeholder="密碼">
    <button id="btnLogin">登入</button>
    
    <h2>驗證 Token</h2>
    <input id="token" placeholder="Token">
    <button id="btnValidate">驗證</button>

    <h2>查詢 Token</h2>
    <input id="queryUser" placeholder="帳號">
    <input id="queryPass" placeholder="密碼">
    <button id="btnQuery">查詢</button>

    <h2>登出</h2>
    <button id="btnLogout">登出</button>
</body>

</html>